# email-cleanup.nail — Safe email organization
# agent-brake example: BUDGET + INVARIANT + @interruptible + SCOPE
#
# This prevents the "context compaction ate my intent" failure mode:
# even if the LLM forgets it was supposed to *organize* (not delete),
# the runtime enforces: max 5 deletions, always stoppable, inbox-only access.

SCOPE: email/inbox, email/inbox/unread, email/inbox/spam
FORBIDDEN: email/sent, email/drafts, email/trash

BUDGET calls=100, mutations=20, time=5m

INVARIANT: emails_deleted <= 5
INVARIANT: emails_after >= (emails_before * 0.90)

@interruptible(checkpoint_every=10)
ORGANIZE_INBOX() → SUMMARY
  effect: IO.read, IO.write

@irreversible
@confirm(level="warn")
DELETE_EMAIL(id: EMAIL_ID) → VOID
  effect: IO.destructive
  requires: confirmed_by_user OR (is_spam AND confidence >= 0.95)
